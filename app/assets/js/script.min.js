var app={}||app;!function(){"use strict";var e,t=jQuery;app.initMap=function(){var t,o;o=document.getElementById("map"),t=[{elementType:"geometry",stylers:[{color:"#7a757b"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#d7c2d2"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#f0e9ee"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d3ccd5"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#3c5842"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#669a5c"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ca9bd2"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#352937"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#dbdddd"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#d48dc2"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#9b8d9c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#8d7985"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#a18a98"}]}],e=new google.maps.Map(o,{center:{lat:50.467859,lng:-116.266224},zoom:7,mapTypeControl:!1,styles:t});var l=[{place_id:"ChIJ_f9-6SYGelMRaZ4lDCFImk4",title:"Kootenay National Park",location:{lat:50.9769367,lng:-115.9592102}},{place_id:"ChIJyaLFSj48eVMRc4lvx8rhwJ0",title:"Two Lakes In Revelstoke National Park",location:{lat:51.0336631,lng:-118.1640469}},{place_id:"ChIJlZGSjCtmd1MR5tfKrGjincA",title:"Banff National Park",location:{lat:51.4968464,lng:-115.9280562}},{place_id:"ChIJxWd-JkUIeVMRuQ7amxSgRPA",title:"Glacier National Park of Canada",location:{lat:51.335289,lng:-117.5297595}},{place_id:"ChIJv0mRixFDb1MRHFgDVHceYN8",title:"Waterton Lakes National Park",location:{lat:49.0833333,lng:-113.9166667}}],i=new a(l);ko.applyBindings(i)},app.mapError=function(){document.getElementById("map").innerHTML="<h3>Can not load the map. Please reload the page, or try again later</h3>"};var o=function(e){this.placeId=ko.observable(e.place_id),this.title=ko.observable(e.title),this.location=ko.observable(e.location),this.marker=ko.observable(),this.description=ko.observable(e.description),this.itemActive=ko.observable(!1)},a=function(a){var l,i,r=this,n=new google.maps.InfoWindow;r.filterInput=ko.observable(""),r.placesList=ko.observableArray([]),r.placesListVisible=ko.observableArray(),r.toggleSidebar=ko.observable(!1),r.errorMessage=ko.observable(""),a.forEach(function(e){r.placesList.push(new o(e))}),r.makeMarkerIcon=function(e){var t=new google.maps.MarkerImage("http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|"+e+"|40|_|%E2%80%A2",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(21,34));return t},i=r.makeMarkerIcon("0091ff"),r.populateInfoWindow=function(t,o,a){if(o.marker!==t){o.marker=t,o.addListener("closeclick",function(){o.marker=null,a.itemActive(!1)});var l=new google.maps.StreetViewService,i=50,r=function(e,l){if(l===google.maps.StreetViewStatus.OK){var i=e.location.latLng,r=google.maps.geometry.spherical.computeHeading(i,t.position);o.setContent('<div class="info-window"><div class="info-window__title">'+a.title()+'</div><div id="pano" class="info-window__view"></div></div>');var n={position:i,pov:{heading:r,pitch:30}};new google.maps.StreetViewPanorama(document.getElementById("pano"),n)}else o.setContent('<div class="info-window"><h3 class="info-window__title">'+a.title()+"</h3><div>No Street View Found</div></div>")};l.getPanoramaByLocation(t.position,i,r),o.open(e,t)}},r.placesList().forEach(function(o){l=new google.maps.Marker({position:new google.maps.LatLng(o.location().lat,o.location().lng),map:e,animation:google.maps.Animation.DROP,icon:i}),o.marker=l;var a="http://en.wikipedia.org/w/api.php?action=opensearch&search="+o.title()+"&format=json&callback=wikiCallback";t.ajax({url:a,dataType:"jsonp",jsonp:"callback",success:function(t){var a=t[2][0]||"Description not found";o.description(a),google.maps.event.addListener(o.marker,"click",function(){r.updateDescriptionVisibility(o),r.populateInfoWindow(this,n,o),o.marker.setAnimation(google.maps.Animation.DROP),e.setCenter(o.marker.getPosition())})},error:function(){r.errorMessage("Failed to get Wikipedia resources")}})}),r.updateDescriptionVisibility=function(e){ko.utils.arrayForEach(r.placesListVisible(),function(t){t.itemActive(t.placeId()===e.placeId())})},r.showPlaceDescription=function(e,t){google.maps.event.trigger(e.marker,"click"),r.updateDescriptionVisibility(e)},r.toggleSidebarHandler=function(){r.toggleSidebar(!r.toggleSidebar())},r.placesListVisible=ko.computed(function(){return r.filterInput()?ko.utils.arrayFilter(r.placesList(),function(e){var t=e.title().toLowerCase().indexOf(r.filterInput().toLowerCase())!==-1;return e.marker.setVisible(t),t}):r.placesList()})}}();